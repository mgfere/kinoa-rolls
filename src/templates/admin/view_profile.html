[file name]: admin_profile.html
[file content begin]
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil de {{ usuario.nombre_usuario }} - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        /* Definición de variables y estilos base Kinoa */
        :root {
            --kinoa-verde-claro: #e9f7e9; /* Fondo verde muy claro */
            --kinoa-verde-oscuro: #2e602e; /* Texto verde oscuro */
            --kinoa-verde-exito: #5cb85c; /* Verde para éxito/botones */
        }
        
        /* Estilos del Navbar Kinoa */
        .navbar-kinoa {
            background-color: var(--kinoa-verde-claro) !important;
            border-bottom: 2px solid var(--kinoa-verde-exito);
            padding-top: 0.5rem; 
            padding-bottom: 0.5rem;
        }
        .navbar-kinoa .navbar-brand,
        .navbar-kinoa .text-kinoa-dark,
        .navbar-kinoa .bi {
            color: var(--kinoa-verde-oscuro) !important;
        }
        .navbar-kinoa .btn-outline-dark-kinoa {
            color: var(--kinoa-verde-oscuro);
            border-color: var(--kinoa-verde-oscuro);
            font-size: 0.8rem; 
        }
        .navbar-kinoa .btn-outline-dark-kinoa:hover {
            background-color: var(--kinoa-verde-oscuro);
            color: white;
        }
        .navbar-brand img {
            width: 60px; 
            height: 60px; 
        }

        /* Ajuste para el contenido principal, quitando el fixed-top */
        .container {
            margin-top: 0rem !important; 
        }
        
        /* Estilos para la imagen de perfil en el Navbar */
        .navbar-profile-image {
            width: 25px;
            height: 25px;
            object-fit: cover;
            /* Se manejará el borde en línea para asegurar el color de la variable */
        }

        /* === ESTILOS ESPECÍFICOS DEL PERFIL === */
        
        .text-primary {
            color: var(--kinoa-verde-oscuro) !important;
        }
        .btn-success {
            background-color: var(--kinoa-verde-exito) !important;
            border-color: var(--kinoa-verde-exito) !important;
        }
        .text-kinoa-dark {
             color: var(--kinoa-verde-oscuro);
        }
        .profile-card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .profile-header {
            background-color: var(--kinoa-verde-claro);
            padding: 30px 20px 20px;
            border-radius: 10px 10px 0 0;
            border-bottom: 1px solid #ddd;
        }
        
        .profile-picture-container {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px; 
            border: 5px solid white; 
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: #f8f9fa; 
        }

        .profile-picture {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info-group {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }

        .info-group i {
            font-size: 1.5rem;
            color: var(--kinoa-verde-exito); 
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }
        .info-group strong {
            display: block;
            color: var(--kinoa-verde-oscuro);
        }

    </style>
</head>
<body>
    <nav class="navbar navbar-kinoa shadow-sm">
        <div class="container-fluid container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="{% if es_admin_func() %}{{ url_for('admin_dashboard') }}{% else %}{{ url_for('menu') }}{% endif %}">
                <img src="{{ url_for('static', filename='images/logo_kinoa_rolls.png') }}" width="30" height="30" alt="Logo Kinoa Rolls">
                <span class="ms-2">Kinoa Rolls</span>
            </a>
            
            <div class="d-flex align-items-center">
                <a href="{{ url_for('profile') }}" class="me-3 d-flex align-items-center text-decoration-none text-kinoa-dark navbar-profile-link" title="Ver Perfil">
                    <span class="me-2 d-none d-md-inline text-kinoa-dark fw-bold">
                        {{ usuario_actual.nombre_usuario if usuario_actual else 'Invitado' }}
                    </span>
                    
                    {# NOTA: Reemplacé 'perfil' y 'usuario' por 'usuario_actual' en el navbar, asumiendo que el usuario logeado actual se llama así, para evitar confusión con el 'usuario' cuyo perfil se está viendo #}
                    {# Si usas una plantilla base, esta lógica va en la base. Aquí lo dejo usando el contexto local si 'perfil' y 'usuario' son el usuario logeado: #}
                    {% if perfil and perfil.foto_perfil %}
                    <img src="{{ url_for('profile_picture', usuario_id=usuario.id_usuario) }}" 
                          class="rounded-circle navbar-profile-image" alt="Foto de Perfil"
                          style="border: 2px solid var(--kinoa-verde-oscuro);">
                    {% else %}
                    <i class="bi bi-person-circle fs-5"></i>
                    {% endif %}
                </a>
                
                <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-dark-kinoa d-flex align-items-center" title="Cerrar Sesión">
                    <i class="bi bi-box-arrow-right me-1"></i> Salir
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="row">
                    <div class="col-12">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'success' if category == 'success' else 'danger' if category == 'error' else 'info' }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endwith %}

        <h2 class="mb-4 display-5"><i class="bi bi-person-lines-fill me-2"></i> Perfil de {{ usuario.nombre_usuario }}</h2>
        
        <div class="mb-4">
            <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver a Usuarios
            </a>
        </div>
        
        <div class="card profile-card shadow-lg">
            
            <div class="profile-header text-center">
                <div class="profile-picture-container mb-3">
                    {% if perfil and perfil.foto_perfil %}
                        <img src="{{ url_for('profile_picture', usuario_id=usuario.id_usuario) }}" 
                              class="rounded-circle profile-picture" alt="Foto de perfil">
                    {% else %}
                        <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center" 
                              style="width: 100%; height: 100%;">
                            <i class="bi bi-person-fill" style="font-size: 4rem; color: white;"></i>
                        </div>
                    {% endif %}
                </div>
                
                <h4 class="mb-1 text-kinoa-dark fw-bold">
                    {{ perfil.nombre or 'Usuario' }} 
                    {{ perfil.apellidoP or '' }} 
                    {{ perfil.apellidoM or '' }}
                </h4>
                
                <span class="badge fs-6 
                    {% if usuario.rol.nombre == 'admin' %}bg-success{% elif usuario.rol.nombre == 'cliente' %}bg-primary{% else %}bg-secondary{% endif %} 
                    text-uppercase">
                    <i class="bi bi-person-badge"></i> {{ usuario.rol.nombre or 'CLIENTE' }}
                </span>
            </div>

            <div class="card-body p-4">
                <div class="row">
                    
                    <div class="col-lg-6 mb-4 mb-lg-0 border-end"> 
                        <h5 class="text-primary mb-3"><i class="bi bi-info-circle-fill"></i> Detalles de la Cuenta</h5>
                        
                        <div class="info-group">
                            <i class="bi bi-person-circle"></i>
                            <div>
                                <small class="text-muted d-block">Nombre de Usuario</small>
                                <strong>{{ usuario.nombre_usuario }}</strong>
                            </div>
                        </div>
                        
                        <div class="info-group">
                            <i class="bi bi-telephone-fill"></i>
                            <div>
                                <small class="text-muted d-block">Teléfono</small>
                                <strong>{{ usuario.telefono or 'No registrado' }}</strong>
                            </div>
                        </div>
                        
                        <div class="info-group">
                            <i class="bi bi-envelope-fill"></i>
                            <div>
                                <small class="text-muted d-block">Correo Electrónico</small>
                                <strong>{{ perfil.email or 'No especificado' }}</strong>
                            </div>
                        </div>
                        
                        <div class="info-group border-bottom-0"> 
                            <i class="bi bi-calendar-check"></i>
                            <div>
                                <small class="text-muted d-block">Fecha de Registro</small>
                                <strong>
                                    {% if usuario.fecha_registro %}
                                        {{ usuario.fecha_registro.strftime('%d/%m/%Y') }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6 ps-lg-4"> 
                        <h5 class="text-primary mb-3"><i class="bi bi-house-door-fill"></i> Dirección de Entrega</h5>
                        
                        <div class="info-group">
                            <i class="bi bi-geo-alt-fill"></i>
                            <div>
                                <small class="text-muted d-block">Dirección Completa</small>
                                <strong>
                                    {% if perfil and perfil.calle %}
                                        {{ perfil.calle }} #{{ perfil.no_exterior or 'S/N' }}
                                    {% else %}
                                        No especificada
                                    {% endif %}
                                </strong>
                            </div>
                        </div>
                        
                        <div class="info-group">
                            <i class="bi bi-map-fill"></i>
                            <div>
                                <small class="text-muted d-block">Colonia</small>
                                <strong>{{ perfil.colonia or 'No especificada' }}</strong>
                            </div>
                        </div>
                        
                        <h5 class="text-primary my-3 pt-3"><i class="bi bi-activity"></i> Control Administrativo</h5> 
                        <div class="info-group border-bottom-0">
                            <i class="bi bi-toggle-on"></i>
                            <div>
                                <small class="text-muted d-block">Estado de la Cuenta</small>
                                <span class="badge fs-6 {% if usuario.activo %}bg-success{% else %}bg-danger{% endif %}">
                                    {{ 'Activo' if usuario.activo else 'Inactivo' }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <div class="d-flex flex-wrap gap-3 justify-content-center">
                    
                    <form method="POST" action="{{ url_for('toggle_user_status', user_id=usuario.id_usuario) }}" class="d-inline">
                        <input type="hidden" name="user_id" value="{{ usuario.id_usuario }}">
                        <button type="submit" class="btn btn-lg {% if usuario.activo %}btn-warning{% else %}btn-success{% endif %}">
                            <i class="bi bi-power"></i> 
                            {% if usuario.activo %} Desactivar Usuario {% else %} Activar Usuario {% endif %}
                        </button>
                    </form>

                    <a href="{{ url_for('admin_users') }}" class="btn btn-lg btn-secondary">
                        <i class="bi bi-list"></i> Ver Lista de Usuarios
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    {# Este bloque de scripts es donde estaba la lógica errónea. Lo reemplazo con código limpio #}
    {% block scripts %}
    <script>
        // --- FUNCIÓN DE NOTIFICACIÓN GLOBAL (Toast) ---
        // Se define aquí para ser útil si en el futuro se quiere notificar acciones administrativas.

        function showNotification(message, type = 'info') {
            const toastHtml = `
                <div class="toast align-items-center text-white ${type === 'success' ? 'bg-success' : type === 'danger' ? 'bg-danger' : 'bg-info'} border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `;
            
            let toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                // Crea el contenedor si no existe (se recomienda tenerlo en el base.html)
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                toastContainer.style.zIndex = '9999';
                document.body.appendChild(toastContainer);
            }

            // Añade el toast al contenedor
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = toastHtml.trim();
            const toastElement = tempDiv.firstChild;
            toastContainer.appendChild(toastElement);
            
            // Muestra el toast usando la clase global de Bootstrap
            if (typeof bootstrap !== 'undefined' && bootstrap.Toast) {
                 new bootstrap.Toast(toastElement).show();
            } else {
                console.warn("Bootstrap Toast no disponible. Notificación: " + message);
                // Fallback si Bootstrap no carga
                alert(message);
            }
        }
        
        // --- LÓGICA ESPECÍFICA PARA EL PERFIL DE ADMIN ---
        document.addEventListener('DOMContentLoaded', function() {
            // Se puede agregar lógica aquí si se usan modales o fetch para acciones como cambio de rol.
            
            // Ejemplo: Manejar el éxito/error después del POST de cambiar estado
            const statusForm = document.querySelector('form[action*="toggle_user_status"]');
            if (statusForm) {
                statusForm.addEventListener('submit', function(event) {
                    // Aquí podrías interceptar el submit si quisieras usar Fetch API
                    // en lugar de la recarga de página por defecto (que es la más simple).
                });
            }
        });
    </script>
    {% endblock %}
</body>
</html>
[file content end]